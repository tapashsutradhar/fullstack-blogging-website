<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Altriveo — Home</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
  </head>

  <body onload="loadPosts()">

<div class="container">
  <header class="blog-header lh-1 py-3 border-bottom">
    <div class="row flex-nowrap justify-content-between align-items-center">
      <div class="col-4 pt-1">
        <a class="link-secondary" href="#">Subscribe</a>
      </div>
      <div class="col-4 text-center">
        <a class="blog-header-logo text-dark text-decoration-none" href="/">Altriveo</a>
      </div>
      <div class="col-4 d-flex justify-content-end align-items-center">
        <a class="link-secondary me-3" href="/login.html">Login</a>
        <a class="btn btn-sm btn-outline-secondary" href="/login.html">Admin</a>
      </div>
    </div>
  </header>

  <div class="nav-scroller py-1 mb-3 border-bottom">
    <nav class="nav nav-underline justify-content-between">
      <a class="nav-item nav-link link-body-emphasis" href="#">World</a>
      <a class="nav-item nav-link link-body-emphasis" href="#">Technology</a>
      <a class="nav-item nav-link link-body-emphasis" href="#">Design</a>
      <a class="nav-item nav-link link-body-emphasis" href="#">Culture</a>
      <a class="nav-item nav-link link-body-emphasis" href="#">Business</a>
    </nav>
  </div>
</div>

<main class="container">

  <!-- FEATURED POST -->
  <div id="featuredPost" class="p-4 p-md-5 mb-4 rounded text-body-emphasis bg-dark" style="display:none;">
    <div class="col-lg-6 px-0">
      <h1 id="featuredTitle" class="display-4 fst-italic text-white"></h1>
      <p id="featuredContent" class="lead my-3 text-white"></p>
      <p><a id="featuredLink" href="#" class="text-white fw-bold">Continue reading...</a></p>
    </div>
  </div>

  <!-- PREVIEW CARDS -->
  <div class="row mb-2" id="previewCards"></div>

  <!-- MAIN POSTS -->
  <div class="row g-5">
    <div class="col-md-8">
      <h3 class="pb-4 mb-4 fst-italic border-bottom">From the Firehose</h3>

      <div id="mainPosts"></div>

      <nav class="blog-pagination" aria-label="Pagination">
        <a class="btn btn-outline-primary disabled">Older</a>
        <a class="btn btn-outline-secondary disabled">Newer</a>
      </nav>
    </div>

    <!-- SIDEBAR -->
    <div class="col-md-4">
      <div class="position-sticky" style="top: 2rem;">
        <div class="p-4 mb-3 bg-body-tertiary rounded">
          <h4 class="fst-italic">About</h4>
          <p class="mb-0">Altriveo is a place to share ideas.</p>
        </div>
        <div class="p-4">
          <h4 class="fst-italic">Archives</h4>
          <ol class="list-unstyled mb-0">
            <li><a href="#">March 2025</a></li>
            <li><a href="#">February 2025</a></li>
            <li><a href="#">January 2025</a></li>
          </ol>
        </div>

        <div class="p-4">
          <h4 class="fst-italic">Elsewhere</h4>
          <ol class="list-unstyled">
            <li><a href="#">GitHub</a></li>
            <li><a href="#">Twitter</a></li>
            <li><a href="#">Facebook</a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>

</main>

<footer class="blog-footer">
  <p>Altriveo — Built locally</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
async function loadPosts() {
  console.log("[DEBUG] Fetching posts from backend");
  try {
    const res = await fetch('/api/posts');
    const posts = await res.json();
    console.log('[DEBUG] Posts received', posts);

    if (!posts || posts.length === 0) return;

    // Featured (most recent)
    const featured = posts[0];
    document.getElementById('featuredTitle').innerText = featured.title;
    document.getElementById('featuredContent').innerText = featured.content.substring(0, 180) + (featured.content.length > 180 ? '...' : '');
    document.getElementById('featuredLink').href = '/post.html?id=' + featured.id;
    document.getElementById('featuredPost').style.display = 'block';

    // Preview cards (posts 2 and 3)
    let previewHTML = '';
    posts.slice(1, 3).forEach((p, i) => {
      previewHTML += `
      <div class="col-md-6">
        <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            <strong class="d-inline-block mb-2 text-primary">${i === 0 ? 'Recent' : 'Update'}</strong>
            <h3 class="mb-0"><a href="/post.html?id=${p.id}">${p.title}</a></h3>
            <div class="mb-1 text-muted">${p.created_at}</div>
            <p class="card-text mb-auto">${p.content.substring(0, 120)}${p.content.length > 120 ? '...' : ''}</p>
            <a href="/post.html?id=${p.id}" class="stretched-link">Continue reading</a>
          </div>
        </div>
      </div>`;
    });
    document.getElementById('previewCards').innerHTML = previewHTML;

    // Main posts (remaining)
    let mainHTML = '';
    posts.slice(3).forEach(p => {
      mainHTML += `
      <article class="blog-post">
        <h2 class="blog-post-title mb-1"><a href="/post.html?id=${p.id}">${p.title}</a></h2>
        <p class="blog-post-meta">${p.created_at}</p>
        <p>${p.content.substring(0, 400)}${p.content.length > 400 ? '...' : ''}</p>
        <hr>
      </article>
      `;
    });
    document.getElementById('mainPosts').innerHTML = mainHTML;

  } catch (e) {
    console.error('[ERROR] loadPosts', e);
  }
}
</script>

</body>
</html>
